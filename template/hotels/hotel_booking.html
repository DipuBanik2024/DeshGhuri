{% extends "base.html" %}
{% load static %}

{% block title %}Book {{ hotel.name }} - TourGuide{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Booking Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Book Your Stay</h1>
            <p class="text-xl text-gray-600">Complete your booking at {{ hotel.name }}</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Booking Form -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Booking Details</h2>
                    
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Room Type Info -->
                        <div class="bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6">
                            <div class="flex items-center gap-4">
                                <!-- Room Image -->
                                {% if room_type.room_image %}
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-lg overflow-hidden">
                                    <img src="{{ room_type.room_image.url }}" alt="{{ room_type.name }}"
                                         class="w-full h-full object-cover">
                                </div>
                                {% else %}
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400">
                                    <i class="fas fa-door-closed text-xl"></i>
                                </div>
                                {% endif %}
                                <div class="flex-1">
                                    <h3 class="font-semibold text-orange-800 mb-1">Selected Room</h3>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-lg font-bold text-gray-900">{{ room_type.name }}</p>
                                            <p class="text-gray-600 text-sm">Capacity: {{ room_type.capacity }} guests • {{ room_type.room_size|default:"Standard" }}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-2xl font-bold text-orange-600">৳{{ room_type.price_per_night }}</p>
                                            <p class="text-gray-600 text-sm">per night</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Fields -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Check-in Date -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Check-in Date</label>
                                {{ form.check_in }}
                                {% if form.check_in.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.check_in.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Check-out Date -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Check-out Date</label>
                                {{ form.check_out }}
                                {% if form.check_out.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.check_out.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Number of Rooms -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Number of Rooms</label>
                                {{ form.number_of_rooms }}
                                {% if form.number_of_rooms.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.number_of_rooms.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Total Guests -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Guests</label>
                                {{ form.total_guests }}
                                {% if form.total_guests.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.total_guests.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Guest Name -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                                {{ form.guest_name }}
                                {% if form.guest_name.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.guest_name.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Guest Email -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                {{ form.guest_email }}
                                {% if form.guest_email.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.guest_email.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Guest Phone -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                {{ form.guest_phone }}
                                {% if form.guest_phone.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.guest_phone.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Special Requests -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Special Requests (Optional)</label>
                                {{ form.special_requests }}
                                {% if form.special_requests.errors %}
                                <p class="text-red-600 text-sm mt-1">{{ form.special_requests.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="mt-8">
                            <button type="submit" class="w-full bg-orange-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-orange-700 transition-all duration-300">
                                <i class="fas fa-lock mr-2"></i>Complete Booking
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Booking Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6 sticky top-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Booking Summary</h3>

                    <!-- Hotel Info -->
                    <div class="flex items-center mb-4 pb-4 border-b border-gray-200">
                        {% if hotel.profile_image %}
                        <div class="w-16 h-16 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0 mr-4">
                            <img src="{{ hotel.profile_image.url }}" alt="{{ hotel.name }}"
                                 class="w-full h-full object-cover">
                        </div>
                        {% else %}
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-lg flex items-center justify-center text-white font-bold text-xl mr-4">
                            {{ hotel.name|first|upper }}
                        </div>
                        {% endif %}
                        <div>
                            <h4 class="font-semibold text-gray-900">{{ hotel.name }}</h4>
                            <p class="text-gray-600 text-sm">{{ room_type.name }}</p>
                        </div>
                    </div>

                    <!-- Price Details -->
                    <div class="space-y-3 mb-4">
                        <div class="flex justify-between text-gray-600">
                            <span>Room price (per night)</span>
                            <span>৳{{ room_type.price_per_night }}</span>
                        </div>
                        <div class="flex justify-between text-gray-600">
                            <span>Number of rooms</span>
                            <span id="rooms-count">1</span>
                        </div>
                        <div class="flex justify-between text-gray-600">
                            <span>Number of nights</span>
                            <span id="nights-count">0</span>
                        </div>
                    </div>

                    <!-- Total -->
                    <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                        <span class="text-lg font-bold text-gray-900">Total Amount</span>
                        <span id="total-amount" class="text-2xl font-bold text-orange-600">৳0</span>
                    </div>

                    <!-- Info Note -->
                    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm text-blue-700">
                            <i class="fas fa-info-circle mr-1"></i>
                            You'll pay at the hotel. This booking is subject to confirmation.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const roomPrice = {{ room_type.price_per_night }};
    const checkInInput = document.querySelector('input[name="check_in"]');
    const checkOutInput = document.querySelector('input[name="check_out"]');
    const roomsInput = document.querySelector('input[name="number_of_rooms"]');
    
    function calculateTotal() {
        const rooms = parseInt(roomsInput.value) || 1;
        const checkIn = new Date(checkInInput.value);
        const checkOut = new Date(checkOutInput.value);
        
        let nights = 0;
        if (checkInInput.value && checkOutInput.value && checkOut > checkIn) {
            nights = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));
        }
        
        document.getElementById('rooms-count').textContent = rooms;
        document.getElementById('nights-count').textContent = nights;
        
        const total = roomPrice * rooms * nights;
        document.getElementById('total-amount').textContent = '৳' + total.toFixed(2);
    }
    
    checkInInput.addEventListener('change', calculateTotal);
    checkOutInput.addEventListener('change', calculateTotal);
    roomsInput.addEventListener('input', calculateTotal);
    
    // Initial calculation
    calculateTotal();
});
</script>
{% endblock %}